<main class="mt-4">
    <section>
        <div class="card mb-3">
            <div class="card-header bg-transparent">
                <div class="row align-items-center">
                    <div class="col-12 col-sm-8 col-md-8 col-lg-8">
                        <h6 class="fw-600 mb-2 mb-sm-0">Download</h6>
                    </div>
                </div>
            </div>


            <div class="card-body">

                <div class="row mb-4" *ngIf="isAdmin">
                    <div class="col-12 col-sm-6 col-md-8 col-lg-8 d-flex flex-wrap gap-2">
                        <!-- All Agencies Programs Button -->
                        <div>
                            <button type="button" class="btn btn-outline-success" style="background-color: limegreen;" matTooltip="Download all agencies programs as Excel or PDF" [matMenuTriggerFor]="allAgenciesProgramsMenu">
                                <i class="bi bi-building me-2"></i>All Agencies Programs
                            </button>
                            <mat-menu #allAgenciesProgramsMenu="matMenu">
                                <button mat-menu-item (click)="downloadAllAgenciesProgramsExcel()">
                                    <i class="bi bi-file-earmark-excel me-2"></i>Excel
                                </button>
                                <button mat-menu-item (click)="downloadAllAgenciesProgramsPdf()">
                                    <i class="bi bi-file-earmark-pdf me-2"></i>PDF
                                </button>
                            </mat-menu>
                        </div>
                    </div>
                </div>

                <!-- Agency Selection Row -->
                <div class="row mb-4" *ngIf="isAdmin" style="height: 50px;">
                    <div class="col-12 col-sm-6 col-md-4 col-lg-4">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>Select Agency</mat-label>
                            <mat-select [(ngModel)]="selectedAgencyId" (selectionChange)="onAgencySelect($event.value)">
                                <mat-select-filter [array]="agencyList" [displayMember]="'agencyName'" (filteredReturn)="agencyListFiltered = $event">
                                </mat-select-filter>
                                <mat-option value="" disabled>Select Agency</mat-option>
                                <mat-option *ngFor="let agency of agencyListFiltered" [value]="agency.agencyId">
                                    {{ agency.agencyName }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                   
                </div>
                <div class="row mb-4" >
                     <div class="col-12 col-sm-6 col-md-8 col-lg-8 d-flex flex-wrap gap-2">
                        <!-- All Participants Button -->
                        <div>
                            <button type="button" class="btn btn-outline-info" style="background-color: limegreen;" matTooltip="Download as Excel or PDF" [matMenuTriggerFor]="allParticipantsMenu">
                                <i class="bi bi-people-fill me-2"></i>All Participants
                            </button>
                            <mat-menu #allParticipantsMenu="matMenu">
                                <button mat-menu-item (click)="downloadAllParticipantsExcel('1')">
                                    <i class="bi bi-file-earmark-excel me-2"></i>Excel
                                </button>
                                <button mat-menu-item (click)="downloadAllParticipantsPdf('1')">
                                    <i class="bi bi-file-earmark-pdf me-2"></i>PDF
                                </button>
                            </mat-menu>
                        </div>
                        <!-- All Programs Button -->
                        <div>
                            <button type="button" style="background-color: limegreen;" class="btn " matTooltip="Download as Excel or PDF" [matMenuTriggerFor]="allProgramsMenu">
                                <i class="bi bi-collection me-2"></i>All Programs
                            </button>
                            <mat-menu #allProgramsMenu="matMenu">
                                <button mat-menu-item (click)="downloadAllParticipantsExcel('2')">
                                    <i class="bi bi-file-earmark-excel me-2"></i>Excel
                                </button>
                                <button mat-menu-item (click)="downloadAllParticipantsPdf('2')">
                                    <i class="bi bi-file-earmark-pdf me-2"></i>PDF
                                </button>
                            </mat-menu>
                        </div>
                        <!-- All Expenditure Button -->
                        <div>
                            <button type="button" style="background-color: limegreen;" class="btn btn-outline-warning" matTooltip="Download as Excel or PDF" [matMenuTriggerFor]="allExpenditureMenu">
                                <i class="bi bi-cash-stack me-2"></i>All Expenditure
                            </button>
                            <mat-menu #allExpenditureMenu="matMenu">
                                <button mat-menu-item (click)="downloadAllParticipantsExcel('3')">
                                    <i class="bi bi-file-earmark-excel me-2"></i>Excel
                                </button>
                                <button mat-menu-item (click)="downloadAllParticipantsPdf('3')">
                                    <i class="bi bi-file-earmark-pdf me-2"></i>PDF
                                </button>
                            </mat-menu>
                        </div>
                        <!-- All Programs Overview Button -->
                        <div *ngIf="isAdmin">
                            <button type="button" style="background-color: limegreen;" class="btn" matTooltip="Download as Excel or PDF" [matMenuTriggerFor]="allProgramsOverviewMenu">
                                <i class="bi bi-eye me-2"></i>All Programs Overview
                            </button>
                            <mat-menu #allProgramsOverviewMenu="matMenu">
                                <button mat-menu-item (click)="downloadAllParticipantsExcel('4')">
                                    <i class="bi bi-file-earmark-excel me-2"></i>Excel
                                </button>
                                <button mat-menu-item (click)="downloadAllParticipantsPdf('4')">
                                    <i class="bi bi-file-earmark-pdf me-2"></i>PDF
                                </button>
                            </mat-menu>
                        </div>
                    </div>
                </div>

                <!-- Program Selection Row -->
                <div class="row mb-4" style="height: 50px;">
                    <div class="col-12 col-sm-6 col-md-4 col-lg-4">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>Select Program</mat-label>
                            <mat-select [(ngModel)]="selectedProgramId" (selectionChange)="onProgramSelect($event.value)">
                                <mat-select-filter [array]="programList" [displayMember]="'programTitle'" (filteredReturn)="programListFiltered = $event">
                                </mat-select-filter>
                                <mat-option value="" disabled>Select Program</mat-option>
                                <mat-option [value]="'ALL'">All Programs</mat-option>
                                <mat-option *ngFor="let program of programListFiltered" [value]="program.programId">
                                    {{ program.programTitle }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-12 col-sm-6 col-md-8 col-lg-8 d-flex flex-wrap gap-2">
                        <!-- Download Sessions Button -->
                        <div>
                            <button type="button" class="btn" style="background-color: limegreen;" matTooltip="Download as Excel or PDF" [matMenuTriggerFor]="downloadSessionsMenu">
                                <i class="bi bi-calendar-event me-2"></i>Sessions
                            </button>
                            <mat-menu #downloadSessionsMenu="matMenu">
                                <button mat-menu-item (click)="downloadSessionsExcel('1')">
                                    <i class="bi bi-file-earmark-excel me-2"></i>Excel
                                </button>
                                <button mat-menu-item (click)="downloadSessionsPdf('1')">
                                    <i class="bi bi-file-earmark-pdf me-2"></i>PDF
                                </button>
                            </mat-menu>
                        </div>
                        <!-- Download Participants Button -->
                        <div>
                            <button type="button" class="btn" style="background-color: limegreen;" matTooltip="Download as Excel or PDF" [matMenuTriggerFor]="downloadParticipantsMenu">
                                <i class="bi bi-person-lines-fill me-2"></i>Participants
                            </button>
                            <mat-menu #downloadParticipantsMenu="matMenu">
                                <button mat-menu-item (click)="downloadSessionsExcel('2')">
                                    <i class="bi bi-file-earmark-excel me-2"></i>Excel
                                </button>
                                <button mat-menu-item (click)="downloadSessionsPdf('2')">
                                    <i class="bi bi-file-earmark-pdf me-2"></i>PDF
                                </button>
                            </mat-menu>
                        </div>
                        <!-- Download Expenditure Button -->
                        <div>
                            <button type="button" class="btn" style="background-color: limegreen;" matTooltip="Download as Excel or PDF" [matMenuTriggerFor]="downloadExpenditureMenu">
                                <i class="bi bi-currency-dollar me-2"></i>Expenditure
                            </button>
                            <mat-menu #downloadExpenditureMenu="matMenu">
                                <button mat-menu-item (click)="downloadSessionsExcel('3')">
                                    <i class="bi bi-file-earmark-excel me-2"></i>Excel
                                </button>
                                <button mat-menu-item (click)="downloadSessionsPdf('3')">
                                    <i class="bi bi-file-earmark-pdf me-2"></i>PDF
                                </button>
                            </mat-menu>
                        </div>
                    </div>
                </div>

                <!-- Download Options Grid -->
                <!-- <div class="row" *ngIf="selectedProgramId">
                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3" *ngIf="selectedProgramId === 'ALL'">
                        <div class="card h-100 border-primary">
                            <div class="card-header bg-primary text-white text-center">
                                <h6 class="mb-0">All Programs</h6>
                            </div>
                            <div class="card-body d-flex flex-column">
                                <button type="button" class="btn  mb-2" (click)="downloadAllPrograms()">
                                    <i class="bi bi-download me-2"></i>Download All Programs
                                </button>
                                <button type="button" class="btn btn-outline-info mb-2" (click)="downloadAllExpenditure()">
                                    <i class="bi bi-download me-2"></i>Download All Expenditure
                                </button>
                                <button type="button" class="btn btn-outline-warning" (click)="downloadAllProgramsOverview()">
                                    <i class="bi bi-download me-2"></i>Download All Programs Overview
                                </button>
                            </div>
                        </div>
                    </div>

                   

                </div> -->

                <!-- No Selection Message -->
                <!-- <div class="row" *ngIf="!selectedAgencyId">
                    <div class="col-12 text-center">
                        <div class="alert alert-info" role="alert">
                            <i class="bi bi-info-circle me-2"></i>
                            Please select an agency to view download options
                        </div>
                    </div>
                </div> -->

                <!-- <div class="row" *ngIf="selectedAgencyId && !selectedProgramId">
                    <div class="col-12 text-center">
                        <div class="alert alert-warning" role="alert">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            Please select a program to view specific download options
                        </div>
                    </div>
                </div> -->
            </div>
        </div>
    </section>
</main>

<!-- Loading Modal -->
<div class="modal fade" id="downloadingModal" tabindex="-1" aria-labelledby="downloadingModalLabel" aria-hidden="true" data-keyboard="false" data-bs-backdrop="static">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h6>Preparing your download...</h6>
                <p class="text-muted mb-0">Please wait while we generate your file</p>
            </div>
        </div>
    </div>
</div>